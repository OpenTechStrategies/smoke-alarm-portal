extends layout

block content
  #container.container-fluid
    #top
      #logo.text-center
        img.logo(src='./smokeAlarmPortal_files/redcross-logo-white-letters.png', alt='American Red Cross')
        if origin == '/311'
          img.img-311-right-square(src='./images/311-chicago.png', alt='311 Chicago')
      #safety-message.row.text-center(role='complementary')
        p.col-xs-12.bigger-centered
          | #{__('Smoke alarms save lives.  Installing a smoke alarm is the first step to keeping your family safe.')}
    #language
      .row
        p.col-xs-12.bigger-centered
            a.language-toggle(data-lang='en') English
            | &nbsp;|&nbsp;
            a.language-toggle(data-lang='es') Español
    #main.row(role='main')
      #left.col-md-3
        if origin != '/311'
          p
            | #{__('The Red Cross and its partners will install a limited number of free smoke alarms for those who cannot afford to purchase smoke alarms or for those who are physically unable to install a smoke alarm.')} #{__('The Red Cross installs a limited number of specialized bedside alarms for individuals who are deaf or hard-of-hearing.')} #{__('To request a free installation, please complete all fields in the form below and click “Submit.”')}
      #center.col-md-6
        .container-fluid(role='form')
          form(action="#{origin}", method="POST", class="form-horizontal")
            fieldset
              .row
                // Text input
                .form-group
                  .col-xs-12
                    label.screenreader(for='name') #{__('Your Name')}
                    input#name.form-control.input-md(name='name', type='text', placeholder='#{__("Your Name")}', class='validate[required]', data-prompt-position='topLeft:0,5')
              .row
                  // Text input
                  .form-group
                    .col-xs-12
                      label.screenreader(for='street_address') #{__('Street Address \& Unit (e.g., 123 Main St., Unit Q)')}
                      input#street_address.form-control.input-md(name='street_address', type='text', placeholder='#{__("Address \& Unit")}', class='validate[required]', data-prompt-position='topLeft:50,5')
              .row
                  // Text input
                  .form-group
                    .col-xs-5
                      label.screenreader(for='city') #{__('City')}
                      input#city.form-control.input-md(name='city', type='text', placeholder='#{__("City")}' class='validate[required]', data-prompt-position='topLeft:0,5')
                    .col-xs-3
                      label.screenreader(for='state') #{__('State')}
                      select#state.form-control(name='state', class='validate[required]', data-prompt-position='topRight:-40,5')
                        option(value='' disabled selected) #{__("State")}
                        option(value='Alabama') AL
                        option(value='Alaska') AK
                        option(value='Arizona') AZ
                        option(value='Arkansas') AR
                        option(value='California') CA
                        option(value='Colorado') CO
                        option(value='Connecticut') CT
                        option(value='Delaware') DE
                        option(value='District of Columbia') DC
                        option(value='Florida') FL
                        option(value='Georgia') GA
                        option(value='Hawaii') HI
                        option(value='Idaho') ID
                        option(value='Illinois') IL
                        option(value='Indiana') IN
                        option(value='Iowa') IA
                        option(value='Kansas') KS
                        option(value='Kentucky') KY
                        option(value='Louisiana') LA
                        option(value='Maine') ME
                        option(value='Maryland') MD
                        option(value='Massachusetts') MA
                        option(value='Michigan') MI
                        option(value='Minnesota') MN
                        option(value='Mississippi') MS
                        option(value='Missouri') MO
                        option(value='Montana') MT
                        option(value='Nebraska') NE
                        option(value='Nevada') NV
                        option(value='New Hampshire') NH
                        option(value='New Jersey') NJ
                        option(value='New Mexico') NM
                        option(value='New York') NY
                        option(value='North Carolina') NC
                        option(value='North Dakota') ND
                        option(value='Ohio') OH
                        option(value='Oklahoma') OK
                        option(value='Oregon') OR
                        option(value='Pennsylvania') PA
                        option(value='Rhode Island') RI
                        option(value='South Carolina') SC
                        option(value='South Dakota') SD
                        option(value='Tennessee') TN
                        option(value='Texas') TX
                        option(value='Utah') UT
                        option(value='Vermont') VT
                        option(value='Virginia') VA
                        option(value='Washington') WA
                        option(value='West Virginia') WV
                        option(value='Wisconsin') WI
                        option(value='Wyoming') WY
                    .col-xs-4
                      label.screenreader(for='zip') #{__('Zip Code')}
                      input#zip.form-control.input-md(name='zip', type='text', placeholder='#{__("Zip Code")}', class='validate[required, custom[zip]]', data-prompt-position='topRight:-40,5')
              .row
                  .form-group
                    .col-xs-5
                      label.screenreader(for='phone') #{__('Phone Number')}
                      input#phone.form-control.input-md(name='phone', type='text', placeholder='#{__("Phone #")}', class='validate[groupRequired[contactPreference], custom[phone-10-digit-US]]', data-prompt-position='topRight:0,5')
                    .col-xs-7
                      label.screenreader(for='email') #{__('Email Address')}
                      input#email.form-control.input-md(name='email', type='text', placeholder='#{__("Email")}', class='validate[groupRequired[contactPreference], custom[email]]', data-prompt-position='topRight:0,5')
              .row
                // http://www.sitepoint.com/understanding-bootstrap-grid-system/ helped
                .form-group
                  .col-xs-12.text-center
                    input(type='hidden', name='_csrf', value='#{csrf}')
                    button#singlebutton.btn.btn-primary(name='singlebutton') #{__("Submit")}
                      img.loader(src='/images/loader.gif', style='display:none;')
      #right.col-md-3
        if origin != '/311'
          p
            | #{__('The American Red Cross and its partners have launched the Home Fire Campaign to reduce deaths and injuries caused by home fires by 25 percent over five years.')} #{__('Depending on where you live and other factors, either an American Red Cross representative or one of our partner organizations will contact you to schedule an installation appointment.')}
            
    #bottom.row
      if origin != '/311'
        p.availability.col-xs-12
          | #{__('availability')}
          span.notabene #{__('  If your location is not listed, please call 800-RED-CROSS to be connected to ')}
          span.notaoptime #{__('your')}
          span.notabene #{__(' local Red Cross Chapter.')}
        p.availability.col-xs-12
          | #{__('If you are able to purchase and install your own smoke alarm, but would like information on home fire safety and smoke alarm installation, please visit ')}
          a(class="contrast-link" href="https://www.redcross.org/sound-the-alarm" target="_blank") #{__('redcross.org/sound-the-alarm')}
          |.
          
      p.availability.col-xs-12(class= origin != '/311' ? "" : "text-center")
        | #{__('This web site is open source ')}
        |&mdash;
        | #{__(' volunteers welcome ')}
        a(class="contrast-link" href="https://github.com/redcross/smoke-alarm-portal/" target="_blank") #{__(' at GitHub')}
        |.

    script(type="text/javascript").
      // data for jquery error tootips, translated by i18n
      var validationRules = {
          '#name': {
            'required': {
              'message': "* " + "#{__('This field is required')}"
            }
          },
          '#street_address': {
            'required': {
              'message': "* " + "#{__('This field is required')}"
            }
          },
          '#city': {
            'required': {
              'message': "* " + "#{__('This field is required')}"
            }
          },
          '#state': {
            'required': {
              'message': "* " + "#{__('This field is required')}"
            }
          },
          '#phone': {
            'groupRequired': {
              'message': "* " + "#{__('Please provide either a 10-digit phone number or an email address')}"
            },
            'custom[phone-10-digit-US]': {
              'message': "* " + "#{__('The phone number is invalid')}"
            }
          },
          '#zip': {
            'required': {
              'message': "* " + "#{__('A valid US zip code is required')}"
            },
            'custom[zip]': {
              'message': "* " + "#{__('A valid US zip code is required')}"
            }
          },
          '#email': {
            'groupRequired': {
              'message': "* " + "#{__('Please provide either a phone number or an email address')}"
            },
            'custom[email]': {
              'message': "* " + "#{__('The email address is invalid')}"
            }
          }
      };
      // Change validation rules for contact info on 311
      if (window.location.pathname.substr(0, 4) === '/311') {
        // Delete contact rules from object, change custom validation classes
        delete validationRules['#email']['custom[email'];
        delete validationRules['#phone']['groupRequired'];
        $('#phone, #email').attr('class', 'form-control input-md');
        $('#email').addClass('validate[custom[email]]');
        $('#phone').addClass('validate[required, custom[phone-10-digit-US]]');
        $('#phone').attr('required', true);

        validationRules['#phone']['required'] = {
          'message': '* ' + "#{__('A 10-digit phone number is required')}"
        };
      }
      $(".form-horizontal").validationEngine({
        'scroll': false,
        'autoPositionUpdate': true,
        'maxErrorsPerField': 1,
        'onValidationComplete': function() {
          $("#singlebutton").prop("disabled", true);
          $("img.loader").show();
          return true;
        },
        'custom_error_messages': validationRules
      });
      // On Firefox and Safari back-forward caching causes the submit button state to be retained,
      // even after clicking the back button. This checks if the state has been cached, and
      // if so re-enables the submit button. https://stackoverflow.com/a/13123626
      $(window).bind("pageshow", function(event) {
        if (event.originalEvent.persisted) {
          $("#singlebutton").prop("disabled", false);
          $("img.loader").hide();
        }
      });
      // Fix Safari font-weight. The bizzare if-clause is feature-detection for Safari.
      if (Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0) { $("body").css("font-weight", "400"); }

